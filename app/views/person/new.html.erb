<script type="text/javascript">
	  var site_type = "<%= @site_type %>";
    var facility_type = "<%= SETTINGS['application_mode']%>"
    String.prototype.capitalize = function(lower) {
        return (lower ? this.toLowerCase() : this).replace(/(?:^|\s)\S/g, function(a) { return a.toUpperCase(); });
    };
    String.prototype.capitalizeAll = function(){
    	return this.toUpperCase();
    };
</script>

<%  if SETTINGS['application_mode'] == "FC" %>

   <% if @type_of_birth != "Single" %>
     

    <%= render 'multiplebirth' %> 

   <% else %>

     <%= render 'form' %>
     
   <% end %>

<%  elsif SETTINGS['application_mode'] == "DC" %>

<% if @type_of_birth != "Single" %>

    <%= render 'multiplebirth' %> 

<% else %> 

 <% case params[:relationship].downcase 
 
		when 'normal'  %>  
			 <%= render 'dcform' %>
		<% when 'adopted'  %>  
			<%= render 'adopted' %>
		<% when 'orphaned'  %>
			<%= render 'orphaned' %>
		<% when 'abandoned' %>
		  <%= render 'abandoned' %>
		<% end %>
 
<% end %>
<%  end %>

<script>
	
	
	function checkSerialNum(){
		
		jQuery.ajax({
			url: "/check_serial_number?person_id=<%=params[:id]%>",
			success: function(result){

				if(result.match(/^P/)){
                        hideSpinner();
				 		window.location = "/person_id_label?person_id=<%=params[:id]%>";
				}else{
					setTimeout(function(){
						checkSerialNum();
					}, 200)						
				}
			},
            error: function(e){
                alert("Failed to Print Barcode");
            }
		})		
	}	

	<% if !params[:id].blank? && SETTINGS['application_mode'] == "FC" && !params[:print_reg].blank? %>	

		checkSerialNum();
	<% end %>
</script>
